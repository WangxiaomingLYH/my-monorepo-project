---
title: 并发请求及应用场景
---

# 并发请求及应用场景

## 并发请求
当我们需要考虑请求速率时, 传统的顺序请求会导致页面加载速度很慢. 此时可以写个方法, 同时发送多个请求, 能显著提高效率

**思路**: 
1. 传入待请求的 url 数组队列及最大并发数
2. 定义数组, 接受响应结果 当前执行中的请求索引 正在运行的请求数 已完成请求数
3. 定义 runRequest 方法, 该返回一个 Promise 对象, 当所有请求全部完成后, 调用 resolve 方法并传递响应结果
4. 初始化批次请求, 从最大并发数和请求队列长度中取最小数, 每次请求后下一个要处理的请求索引++, 会发送最大并发数个请求
4. 循环调用 runRequest 方法, 直到请求队列全部入栈后结束
4. runRequest 方法:
    1. 首次进入后, 正在运行的请求数++
    2. 从请求队列中解构出 url 和 options, 并发送请求
    3. 拿到响应的数据, 存储到响应结果集合中(成功和失败都存进去)
    4. 请求结束后, 当前正在运行的请求数--; 已完成请求数++
    5. 检查请求完成数是否等于队列长度, 若相等则调用 resolve() 方法, 确定该 Promise 的状态后传递所有的响应结果数据

**思路二**
1. 初始化创建最大请求数的工作函数
2. 使用 while 循环的方式, 不断的发送请求